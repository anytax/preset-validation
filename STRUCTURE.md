# Project Structure

This document describes the organized structure of the `@anytax/preset-validation` package.

## Directory Structure

```
preset-validation/
├── src/                           # Source code
│   ├── index.ts                   # Main entry point (exports)
│   ├── preset-validation.helper.ts # Core validation functions
│   ├── country-codes.json         # ISO country codes data
│   └── tax-number/                # Tax number validation modules
│       ├── finanzamtsdaten.ts     # German tax office database
│       ├── finanzamtsdaten-test.ts # Test tax office data
│       ├── normalization.ts        # Tax number normalization
│       ├── prufziffernverfahren.ts # Check digit algorithms
│       └── validation-tax-number.ts # Tax number validation
│
├── test/                          # Test files
│   ├── preset-validation.helper.spec.ts # Main validation tests
│   └── validation-tax-number.spec.ts    # Tax number tests
│
├── dist/                          # Compiled output (published to npm)
│   ├── index.js & index.d.ts      # Main entry
│   ├── preset-validation.helper.js
│   ├── country-codes.json
│   └── tax-number/                # Compiled tax modules
│
├── node_modules/                  # Dependencies (not published)
│
├── Configuration Files
│   ├── package.json               # Package configuration
│   ├── tsconfig.json              # TypeScript configuration
│   ├── jest.config.js             # Jest test configuration
│   ├── .eslintrc.js               # ESLint configuration
│   ├── .npmignore                 # npm publish exclusions
│   └── .gitignore                 # Git exclusions
│
└── Documentation
    ├── README.md                  # Main documentation
    ├── LICENSE                    # MIT License
    ├── PUBLISHING.md              # Publishing guide
    ├── NPM_PACKAGE_SETUP.md       # Setup summary
    └── STRUCTURE.md               # This file
```

## Key Design Decisions

### 1. **src/ Directory**
All source TypeScript files are in `src/`. This provides:
- Clear separation between source code and configuration
- Cleaner root directory
- Standard project structure
- Easy to scale as project grows

### 2. **test/ Directory**
Test files are separated from source code:
- `test/` contains all `.spec.ts` and `.test.ts` files
- Tests import from `../src/` using relative paths
- Not included in the published package (via `.npmignore`)
- Jest configured to look for tests in `test/` directory

### 3. **dist/ Directory**
Compiled JavaScript output:
- Generated by TypeScript compiler (`tsc`)
- Mirrors the structure of `src/`
- Includes `.js`, `.d.ts`, `.js.map`, and `.d.ts.map` files
- Only this directory is published to npm
- Cleaned before each build

### 4. **Special Files**

#### finanzamtsdaten-test.ts
This file is in `src/tax-number/` (not `test/`) because:
- Contains test data (TEST_BUFA_MAP) used by production code
- Imported by `finanzamtsdaten.ts` for test tax office definitions
- Not an actual test file (no test assertions)
- Needs to be compiled and included in dist

#### country-codes.json
- Source: `src/country-codes.json`
- Copied to `dist/` during build via `copy-assets` script
- Used by IBAN and BIC validators for country code verification

## Build Process

```bash
npm run build
```

This runs:
1. `npm run clean` → Removes `dist/` directory
2. `tsc` → Compiles TypeScript from `src/` to `dist/`
3. `npm run copy-assets` → Copies `country-codes.json` to `dist/`

### TypeScript Compilation
- **rootDir**: `./src` - Source directory
- **outDir**: `./dist` - Output directory
- **include**: `src/**/*.ts` - All TypeScript files in src
- **exclude**: Test files and directories

## Import Paths

### For Consumers (after npm install)
```typescript
import { validateIBAN } from '@anytax/preset-validation';
```

### For Tests (internal)
```typescript
// From test/preset-validation.helper.spec.ts
import { validateIBAN } from '../src/index';

// From test/validation-tax-number.spec.ts
import { validateSteuernummer } from '../src/tax-number/validation-tax-number';
```

### Internal Imports (within src/)
```typescript
// From src/index.ts
export { ... } from './preset-validation.helper';

// From src/preset-validation.helper.ts
import { validateSteuernummer } from './tax-number/validation-tax-number';

// From src/tax-number/validation-tax-number.ts
import { BUFA_MAP } from './finanzamtsdaten';
```

## Published Package Structure

When published to npm, only these files are included:

```
@anytax/preset-validation/
├── dist/                    # All compiled files
│   ├── index.js
│   ├── index.d.ts
│   ├── preset-validation.helper.js
│   ├── preset-validation.helper.d.ts
│   ├── country-codes.json
│   └── tax-number/
│       └── ... (all compiled modules)
├── README.md
└── LICENSE
```

Excluded from npm package (via `.npmignore`):
- `src/` - Source TypeScript files
- `test/` - Test files
- Configuration files
- Development files

## Package Entry Points

Defined in `package.json`:

```json
{
  "main": "dist/index.js",      // For require()
  "types": "dist/index.d.ts"    // For TypeScript
}
```

## Benefits of This Structure

✅ **Clean Separation** - Source, tests, and output clearly separated  
✅ **Professional** - Follows standard npm package conventions  
✅ **Scalable** - Easy to add more modules as project grows  
✅ **Clear Imports** - Obvious where code lives and how to import  
✅ **Smaller Package** - Only compiled code published, not source  
✅ **Better IDE Support** - Clear file organization  
✅ **Maintainable** - Easy for contributors to understand structure

## Development Workflow

```bash
# Install dependencies
npm install

# Build the package
npm run build

# Run tests
npm test

# Clean build artifacts
npm run clean

# Lint code
npm run lint
```

## Adding New Features

### New Validation Function
1. Add to `src/preset-validation.helper.ts` or create new file in `src/`
2. Export from `src/index.ts`
3. Add tests in `test/` directory
4. Run `npm run build` to compile

### New Tax Module
1. Add file to `src/tax-number/`
2. Import in relevant files
3. Add tests in `test/`
4. Build and verify

---

**Last Updated**: December 9, 2025

